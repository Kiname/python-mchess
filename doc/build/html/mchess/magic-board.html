
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>&lt;no title&gt; &#8212; mchess 0.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p># Magic Chessboard Communications Protocol - Dave Woodfield 25/10/17</p>
<p>Data transfer to/from the Magic Chessboard (MB) will be at 38400 baud, odd parity, 7 bit, 1 stop.
All data is printable ASCII. All data strings are terminated in a block-parity check character.
Commands will only be actioned and acknowledged by the MB if the format and X-Y parity check is correct.
The odd X parity will be performed by the USB serial driver. The Y parity is generated by taking the binary XOR of all
of the transmitted ASCII characters including the command character and all of the data characters upto the check-byte.
This value is then transmitted as a further 2 hex characters.</p>
<p>## Command ‘S’ - Status</p>
<p>This command retrieves the piece status of the complete board.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
S           Command character
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-</p>
<p>s           Lower-case acknowledge character
&lt;Pcode&gt;&lt;Pcode&gt;……….&lt;Pcode&gt;     64 * Piece codes. Data order is A8…H8,A7…H7 etc.
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id3"><span class="problematic" id="id4">``</span></a>`
<cite>&lt;Pcodes&gt;</cite> are K,Q,R,N,B,P for white pieces and k,q,r,n,b,p for black. An empty square returns <cite>‘.’</cite> .</p>
<p>## Command ‘L’ - LED</p>
<p>The LED command sets the flash pattern of all 81 LEDs on the board.</p>
<p><a href="#id5"><span class="problematic" id="id6">``</span></a>`
L           Command character
XX          Slot time – 2 hex digits
&lt;Lcode&gt;&lt;Lcode&gt;……….&lt;Lcode&gt;     81 * LED codes, LED 1 to LED 81
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-</p>
<p>l           Lower-case acknowledge character
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id7"><span class="problematic" id="id8">``</span></a><a href="#id9"><span class="problematic" id="id10">`</span></a></p>
<p><cite>&lt;Lcode&gt;</cite> parameters consist of 2 upper-case hex characters representing an LED pattern byte. The LEDs follow the bit pattern from b7 to b0, changing every LED time slot, e.g. &lt;Lcode&gt; = C4 will give an ON, ON, OFF, OFF, OFF, ON, OFF, OFF flash pattern repeating every 8 time slots. The slot time is set in units of 4.096mS.</p>
<p>LED 1 is in the A8 corner, LED 9 is in the A1 corner</p>
<p>LED 73 is in the H8 corner, LED 81 is in the H1 corner</p>
<p>## Command ‘X’ – eXtinguish all LEDs</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a>`
X           Command character
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-</p>
<p>x           Lower-case acknowledge character
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>## Command ‘T’ - reseT</p>
<p>This command will cause a hardware reset of the MB. There will be a start-up delay of 3 seconds and the MB will then start scanning again. Note that status and LED arrays will be cleared.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">T</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Command</span> <span class="pre">character</span>
<span class="pre">&lt;Chk&gt;</span>&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Block</span> <span class="pre">parity</span> <span class="pre">check</span> <span class="pre">byte</span> <span class="pre">-</span> <span class="pre">2</span> <span class="pre">hex</span> <span class="pre">digits</span>
<span class="pre">`</span></code></p>
<p>There will be no reply as a hardware reset is performed immediately upon correct receipt of this command.</p>
<p>## Command ‘V’ - Version</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a>`
V           Command character
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-
v           Lower-case acknowledge character
XX          Firmware version number high – 2 hex digits
XX          Firmware version number low – 2 hex digits
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>## Command ‘W’ – Write E2ROM</p>
<p>This command is used to write the E2 memory in the MB where operating parameters are stored. All values are transferred as upper-case hex characters. E2 locations above 0x10 may be used for other non-volatile data if required by the host.</p>
<p><a href="#id23"><span class="problematic" id="id24">``</span></a>`
W           Command character
XX          Address – 2 hex digits
XX          Data byte – 2 hex digits
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-</p>
<p>w           Lower-case acknowledge character
XX          Address – 2 hex digits
XX          Data byte – 2 hex digits
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a></p>
<p>## Command ‘R’ – Read E2ROM</p>
<p>This command is used to read the E2 memory in the MB where operating parameters are stored. All values are transferred as upper-case hex characters.</p>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a>`
R           Command character
XX          Address – 2 hex digits
&lt;Chk&gt;       Block parity check byte - 2 hex digits</p>
<p>Reply:-</p>
<p>r           Lower-case acknowledge character
XX          Address – 2 hex digits
XX          Data byte – 2 hex digits
&lt;Chk&gt;       Block parity check byte - 2 hex digits
<a href="#id31"><span class="problematic" id="id32">``</span></a><a href="#id33"><span class="problematic" id="id34">`</span></a></p>
<p>### E2ROM option bytes:</p>
<p>#### Address 00 = Serial port setup</p>
<p>The block parity should normally be enabled, but can be disabled to enable easier testing with a terminal emulator.</p>
<p><a href="#id35"><span class="problematic" id="id36">``</span></a>`
b0    = Block parity disable
0       Enabled (default)
1       Disabled</p>
<p>b7-b1   Unused
<a href="#id37"><span class="problematic" id="id38">``</span></a><a href="#id39"><span class="problematic" id="id40">`</span></a></p>
<p>#### Address 01 = Scan time
This is the time in units of 2.048mS to do a complete scan of the board. It defaults to 20 giving a scan time of 40.96mS, or 24.4 scans per second. This is a safe value which will work reliably in all conditions with all playing pieces, however if all of the pieces in a set give their nominal or faster response this value can be reduced by trial and error to a theoretical minimum of 15, giving a scan rate in excess of 32 scans per second.</p>
<p>The scan time can be increased if desired to reduce the number of status messages that may be sent as a piece is swept across the board, but this can increase the delay before a position change may be seen. For speed chess the scan time should be short to get an almost immediate response and any move debounce done in the host software.</p>
<p>The minimum allowed value is 15, anything less than this will set 20. The maximum value is 255 which will give 1.9 scans per second.</p>
<p>#### Address 02 = Automatic reports</p>
<p>If enabled automatic reports may by inserted between any command and it’s acknowledgement. It is therefore important that all acknowledge messages have their type checked to match then up with the command that instigated them. The format is the same as a reply to the board status command.</p>
<p><a href="#id41"><span class="problematic" id="id42">``</span></a>`
b2-b0 = Automatic status reports
000     Send status on every scan (default)
001     Disabled. Use ‘S’ command
010     Send status with time set at address 03
011     Send status on any change
100     Send status on any change with 2 scan debounce
101     Send status on any change with 3 scan debounce
110     Send status on any change with 4 scan debounce
111     Send status on any change with 5 scan debounce</p>
<p>b7-b3   Unused
<a href="#id43"><span class="problematic" id="id44">``</span></a><a href="#id45"><span class="problematic" id="id46">`</span></a></p>
<p>#### Address 03 = Automatic status report time</p>
<p>This is the time between automatic status reports if enabled, in units of 4.096mS.</p>
<p>#### Address 04 = LED brightness</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">0</span> <span class="pre">=</span> <span class="pre">Dim,</span> <span class="pre">&gt;14</span> <span class="pre">=</span> <span class="pre">Full</span> <span class="pre">brightness</span>
<span class="pre">`</span></code></p>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">mchess</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chess_link.html">ChessLink object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chess_link_protocol.html">ChessLink protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chess_link_transports.html">USB transport</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chess_link_transports.html#ble-transport">BLE transport</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Dominik Schlösser.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../_sources/mchess/magic-board.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>